
project frameworks/av/
diff --git a/frameworks/av/media/libstagefright/ACodec.cpp b/frameworks/av/media/libstagefright/ACodec.cpp
index a110eae..c2010c5 100644
--- a/frameworks/av/media/libstagefright/ACodec.cpp
+++ b/frameworks/av/media/libstagefright/ACodec.cpp
@@ -98,6 +98,10 @@
 
 #include "include/avc_utils.h"
 
+#if defined(OMAP_ENHANCEMENT) || defined(OMAP_TUNA)
+#include <cutils/properties.h>
+#endif
+
 #ifdef ENABLE_AV_ENHANCEMENTS
 #include <QCMediaDefs.h>
 #include <ExtendedUtils.h>
@@ -4971,6 +4976,14 @@ bool ACodec::BaseState::onOMXFillBufferDone(
 
             reply->setInt32("buffer-id", info->mBufferID);
 
+#if defined(OMAP_ENHANCEMENT) || defined(OMAP_TUNA)
+            char value[PROPERTY_VALUE_MAX];
+            if (property_get("persist.gallery.player", value, "0")) {
+                if (!strcmp(value, "1")) {
+                    reply->setInt32("render", true);
+                }
+            }
+#endif
             notify->setMessage("reply", reply);
 
             notify->post();
